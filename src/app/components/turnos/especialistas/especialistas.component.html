<div class="container text-center mt-5">
  <h1 class="mb-4 text-primary">Mis turnos</h1>

  <!-- Campo de búsqueda -->
  <input
    type="text"
    placeholder="Buscar turnos o historia clínica..."
    [(ngModel)]="searchText"
    class="form-control mb-3"
  />

  <!-- Lista de Turnos Filtrados -->
  <div *ngFor="let turno of nombresEspecialistasArray | filter: searchText: ['especialidad', 'paciente', 'comentario', 'altura', 'peso', 'presion', 'temperatura', 'usuario', 'diagnostico', 'estado']">
    <ul class="list-group mt-4" *ngIf="turno.emailEspecialsita == doctorActual">
      
      <li class="list-group-item">
        <div class="d-flex justify-content-between align-items-center">
          <!-- Información del turno -->
          <div>
            <h4 class="text-primary mb-1">{{ turno.especialidad }}</h4>
            <p class="mb-1">
              <strong>{{ turno.paciente }}</strong> - {{ turno.horario }}
            </p>
          </div>

          <!-- Botones según el estado del turno -->
          <div *ngIf="turno.estado === 'pendiente'">
            <button class="btn btn-outline-success btn-sm me-2" (click)="cambiarEstado('aceptado', turno)">
              <i class="bi bi-check-circle"></i> Aceptar
            </button>
            <button class="btn btn-outline-danger btn-sm me-2" (click)="cambiarEstado('rechazado', turno)">
              <i class="bi bi-x-circle"></i> Rechazar
            </button>

            <button class="btn btn-outline-danger btn-sm me-2" (click)="cambiarEstado('rechazado', turno)">
              <i class="bi bi-x-circle"></i> Cancelar
            </button>

          </div>

          <div *ngIf="turno.estado === 'aceptado'">
            <button class="btn btn-outline-success btn-sm me-2" (click)="cambiarEstado('finalizar', turno)">
              <i class="bi bi-check-circle"></i> Finalizar Turno
            </button>
          </div>

          <button *ngIf="turno.estado === 'finalizar'" class="btn btn-primary btn-sm" (click)="mostrarFormularioDiagnostico(turno)">
            Diagnóstico
          </button>

          <button *ngIf="turno.estado === 'diagnosticado'" class="btn btn-primary btn-sm" (click)="mostrarFormularioHistoriaClinica(turno)">
            Historia Clínica
          </button>

          <button *ngIf="turno.estado === 'historiaClinica'" class="btn btn-primary btn-sm" (click)="verDiagnosticoTerminado(turno)">
            Ver Reseña
          </button>
        </div>

        <!-- Formulario de Diagnóstico -->
        <div *ngIf="turno.mostrarFormularioDiagnostico" class="mt-3 p-3 bg-light border rounded">
          <h5 class="text-secondary">Ingresar Diagnóstico</h5>
          <div class="mb-3">
            <label for="diagnosticoInput" class="form-label">Diagnóstico:</label>
            <input type="text" id="diagnosticoInput" [(ngModel)]="turno.diagnostico" class="form-control" placeholder="Escribe el diagnóstico aquí" />
          </div>
          <div class="mb-3">
            <label for="comentariosInput" class="form-label">Comentarios:</label>
            <textarea id="comentariosInput" [(ngModel)]="turno.comentarios" class="form-control" placeholder="Escribe tus comentarios aquí"></textarea>
          </div>
          <button  class="btn btn-success btn-sm" (click)="guardarDiagnostico(turno, turno.paciente)">Guardar Diagnóstico</button>
          <button class="btn btn-secondary btn-sm ms-2" (click)="ocultarFormularioDiagnostico(turno)">Cancelar</button>
        </div>

        <!-- Formulario de Historia Clínica -->
        <div *ngIf="turno.mostrarFormularioHistoriaClinica" class="mt-3 p-3 bg-light border rounded">
          <h5 class="text-secondary">Ingresar Historia Clínica</h5>
          <div class="mb-3">
            <label for="alturaInput" class="form-label">Altura (cm):</label>
            <input type="number" id="alturaInput" [(ngModel)]="turno.altura" class="form-control" placeholder="Ejemplo: 170" />
          </div>
          <div class="mb-3">
            <label for="pesoInput" class="form-label">Peso (kg):</label>
            <input type="number" id="pesoInput" [(ngModel)]="turno.peso" class="form-control" placeholder="Ejemplo: 70" />
          </div>
          <div class="mb-3">
            <label for="temperaturaInput" class="form-label">Temperatura (°C):</label>
            <input type="number" id="temperaturaInput" [(ngModel)]="turno.temperatura" class="form-control" placeholder="Ejemplo: 36.5" />
          </div>
          <div class="mb-3">
            <label for="presionInput" class="form-label">Presión Arterial:</label>
            <input type="text" id="presionInput" [(ngModel)]="turno.presion" class="form-control" placeholder="Ejemplo: 120/80" />
          </div>
          <button class="btn btn-success btn-sm" (click)="guardarHistoriaClinica(turno, turno.paciente)">Guardar Historia Clínica</button>
          <button class="btn btn-secondary btn-sm ms-2" (click)="ocultarHistoriaClinica(turno)">Cancelar</button>
        </div>
      </li>
    </ul>
  </div>
</div>
